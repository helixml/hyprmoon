# Install our HyprMoon package
RUN dpkg -i /tmp/hyprmoon_*.deb \
    && (dpkg -i /tmp/hyprland-backgrounds_*.deb || echo "Backgrounds package install failed - continuing without backgrounds") \
    && rm /tmp/hyprmoon_*.deb /tmp/hyprland-backgrounds_*.deb \
    && echo "$(dpkg -l hyprmoon | grep hyprmoon | awk '{print $3}')" > /HYPRMOON_VERSION.txt

# INCREMENTAL_BINARY_COPY_START
# COPY_BINARY_MARKER
COPY Hyprland-0.41.2+ds-1.3+step8.9.62 /tmp/Hyprland-incremental
# COPY_VERSION_MARKER
COPY HYPRMOON_VERSION.txt /tmp/
RUN echo "ðŸ”¥ INCREMENTAL DEPLOY: Clobbering with latest binary" \
    && cp /tmp/Hyprland-incremental /usr/bin/Hyprland \
    && chmod +x /usr/bin/Hyprland \
    && cp /tmp/HYPRMOON_VERSION.txt /HYPRMOON_VERSION.txt \
    && echo "âœ“ Binary clobbered with version: $(cat /HYPRMOON_VERSION.txt)" \
    && rm -f /tmp/Hyprland-incremental /tmp/HYPRMOON_VERSION.txt
INCREMENTAL_BINARY_COPY_END

# Copy everything from Go build stage LAST to avoid cache invalidation
COPY --from=go-build-env /usr/local/go /usr/local/go